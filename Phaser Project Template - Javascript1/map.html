<!DOCTYPE html>
<meta charset="utf-8">
<style>
  .graticule {
    fill: none;
    stroke: #777;
    stroke-width: .5px;
    stroke-opacity: .5;
  }

  .land {
    fill: #222;
  }

  .boundary {
    fill: none;
    stroke: #fff;
    stroke-width: .5px;
  }

 .background {
  fill: none;
  pointer-events: all;
}

.feature {
  fill: #ccc;
  cursor: pointer;
}

.feature.active {
  fill: orange;
}

.mesh {
  fill: none;
  stroke: #fff;
  stroke-linecap: round;
  stroke-linejoin: round;
}
</style>
<body>
  <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <script>




    var width = $(window).width(),
        height = $(window).height(),
        active = d3.select(null);

    var projection = d3.geo.equirectangular()
        .scale(250)
        .translate([width / 2, height / 2])
        .precision(.1);

    var path = d3.geo.path()
        .projection(projection);

    var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height)

    svg.append("rect")
      .attr("class", "background")
      .attr("width", width)
      .attr("height", height)
      .on("click", reset);

    var g = svg.append("g")
    .style("stroke-width", "1.5px");



    d3.json("assets/json/world-50m.json", function (error, world) {

      // Fetch Country data
      var countries = topojson.feature(world, world.objects.countries).features;

      // Fetch Neightbors data
      var neighbors = topojson.neighbors(world.objects.countries.geometries);

      console.log(countries);
      console.log(neighbors)


      g.selectAll(".country")
        .data(countries)
        .enter().insert("path", ".graticule")
        .attr("class", "country")
        .attr("d", path)
        .style("fill", function (d) { return "#C0C0C0" }) // Country Color
        .on("click", clicked)
        .on("mouseover", function (d) {

          // Country Hover
          console.log(d)
        });


      g.insert("path", ".graticule")
          .datum(topojson.mesh(world, world.objects.countries, function (a, b) { return a !== b; }))
          .attr("class", "boundary")
          .attr("d", path);




      var marks = [{ long: -75, lat: 43 }, { long: -78, lat: 41 }, { long: -70, lat: 53 }];

      g.selectAll(".mark")
          .data(marks)
          .enter()
          .append("image")
          .attr('class', 'mark')
          .attr('width', 20)
          .attr('height', 20)
          .attr("xlink:href", 'https://cdn3.iconfinder.com/data/icons/softwaredemo/PNG/24x24/DrawingPin1_Blue.png')
          .attr("transform", function (d) { return "translate(" + projection([d.long, d.lat]) + ")"; });


    });

    function clicked(d) {
      if (active.node() === this) return reset();
      active.classed("active", false);
      active = d3.select(this).classed("active", true);

      var bounds = path.bounds(d),
          dx = bounds[1][0] - bounds[0][0],
          dy = bounds[1][1] - bounds[0][1],
          x = (bounds[0][0] + bounds[1][0]) / 2,
          y = (bounds[0][1] + bounds[1][1]) / 2,
          scale = .9 / Math.max(dx / width, dy / height),
          translate = [width / 2 - scale * x, height / 2 - scale * y];


      g.transition()
          .duration(750)
          .style("stroke-width", 1.5 / scale + "px")
          .attr("transform", "translate(" + translate + ")scale(" + scale + ")");
    }

    function reset() {
      active.classed("active", false);
      active = d3.select(null);

      g.transition()
          .duration(750)
          .style("stroke-width", "1.5px")
          .attr("transform", "");
    }

    d3.select(self.frameElement).style("height", height + "px");

  </script>
